#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ healthcheck

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ healthcheck –ª–æ–∫–∞–ª—å–Ω–æ"
echo ""

# –°–ø–æ—Å–æ–± 1: –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ cargo (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Rust)
echo "üì¶ –°–ø–æ—Å–æ–± 1: –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ cargo"
echo "   –ö–æ–º–∞–Ω–¥–∞: cargo run"
echo "   –ó–∞—Ç–µ–º –≤ –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ: curl http://localhost:3000/health"
echo ""

# –°–ø–æ—Å–æ–± 2: –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker
echo "üê≥ –°–ø–æ—Å–æ–± 2: –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker"
echo "   1. –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞:"
echo "      docker build -t burger-be ."
echo ""
echo "   2. –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:"
echo "      docker run -p 3000:3000 -e PORT=3000 burger-be"
echo ""
echo "   3. –ü—Ä–æ–≤–µ—Ä–∫–∞ healthcheck:"
echo "      curl http://localhost:3000/health"
echo ""

# –°–ø–æ—Å–æ–± 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä —É–∂–µ –∑–∞–ø—É—â–µ–Ω
echo "‚úÖ –°–ø–æ—Å–æ–± 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ healthcheck (–µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä —É–∂–µ –∑–∞–ø—É—â–µ–Ω)"
echo "   curl http://localhost:3000/health"
echo "   curl http://localhost:3000/"
echo ""

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
echo "üîé –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞..."
if curl -s -f http://localhost:3000/health > /dev/null 2>&1; then
    echo "‚úÖ –°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ /health"
    curl -s http://localhost:3000/health | jq . 2>/dev/null || curl -s http://localhost:3000/health
    echo ""
else
    echo "‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 3000"
    echo "   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω"
fi
